<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_qz5_bgk_np">
 <title>LET clause</title>
 <shortdesc>Use <codeph>LET</codeph> to create and use variables within a query.</shortdesc>

 <body>
    <p><i>(Introduced in Couchbase Server 4.0)</i></p>
    <section id="section_dxz_xxp_2cb">
      <title>Purpose</title>
      <p>In a query expression, it is sometimes useful to store the result of a sub-expression in
        order to use it in subsequent clauses. You can do this with the <codeph>LET</codeph>
        keyword, which creates a new variable and initializes it with the result of the expression
        you supply. You can use the <codeph>LET</codeph> clause within an array, in a for-loop, or
        independently.</p>
      <p>For example, set a variable to 71, detailed in <xref
          href="#topic_qz5_bgk_np/examples_section" format="dita">Example
        1</xref>:<codeblock>SELECT airportname, geo.lat
FROM `travel-sample`
<b>LET minimum_lat = 71</b>
WHERE geo.lat > minimum_lat;</codeblock>Without
        the LET clause, your complex queries would need to be divided into two separate queries: one
        query to get a particular value (or set of values), and one query to use the value (or
        values) from the first query.</p>
    </section>
    <section id="section_wmc_lyp_2cb">
      <title>Prerequisites</title>
      <p>The <codeph>LET</codeph> clause can only be used in a <codeph>SELECT</codeph> statement,
        and in order for you to select data from a document or keyspace, you must have the
          <parmname>query_select</parmname> privilege on the document or keyspace. For more details
        about user roles, see <xref href="../../security/security-authorization.dita#authorization"
        />.</p>
    </section>
    <section id="section_ofl_myp_2cb">
      <title>Syntax</title>
      <p><codeblock>LET (<varname>alias</varname> = <varname>expr</varname>) [, (<varname>alias2</varname> = <varname>expr2</varname>)]*</codeblock><image
          href="images/let-clause.png" id="image_exl_4yp_2cb"/></p>
    </section>
    <section id="section_od3_pyp_2cb">
      <title>Arguments</title>
      <p>
        <dl>
          <dlentry>
            <dt>alias</dt>
            <dd>[Required] String or expression that represents the name of the variable.</dd>
          </dlentry>
        </dl>
        <dl>
          <dlentry>
            <dt>expr</dt>
            <dd>[Required] String or expression that represents the value assigned to its
                <varname>alias</varname>.</dd>
          </dlentry>
        </dl>
      </p>
    </section>
    <section id="examples_section">
      <title>Examples</title>
      <p><b>Example 1: Use <codeph>LET</codeph> to set a variable to a number.</b></p>
      <p>Create the variable <codeph>minimum_lat</codeph> for the minimum latitude and set it to
        "71" to use later for airport latitudes in the <codeph>WHERE</codeph> clause.</p>
      <p><codeblock>SELECT airportname, geo.lat
FROM `travel-sample`<b>
LET minimum_lat = 71</b>
WHERE geo.lat > minimum_lat;</codeblock>Results:<codeblock>[
  {
    "airportname": "Wiley Post Will Rogers Mem",
    "lat": 71.285446
  },
  {
    "airportname": "Dillant Hopkins Airport",
    "lat": 72.270833
  }
]</codeblock></p>
      <p><b>Example 2: Use <codeph>LET</codeph> to assign a variable in a for-loop through an
          array.</b></p>
      <p>Create the variable <codeph>items</codeph> to search through the <codeph>lat</codeph> field
        for values larger than 70 of the array <codeph>item</codeph>.</p>
      <p><codeblock>SELECT airportname, geo.lat AS high_latitude 
FROM `travel-sample`
<b>LET items = ARRAY item FOR item IN geo.lat WHEN item.lat > 70 END</b>
WHERE airportname IS NOT NULL
ORDER BY geo.lat DESC
LIMIT 5;</codeblock>Results:<codeblock>[
  {
    "airportname": "Dillant Hopkins Airport",
    "high_latitude": 72.270833
  },
  {
    "airportname": "Wiley Post Will Rogers Mem",
    "high_latitude": 71.285446
  },
  {
    "airportname": "Wainwright Airport",
    "high_latitude": 70.638056
  },
  {
    "airportname": "Wainwright As",
    "high_latitude": 70.613378
  },
  {
    "airportname": "Atqasuk Edward Burnell Sr Memorial Airport",
    "high_latitude": 70.4673
  }
]</codeblock></p>
    </section>
  </body>
</topic>
