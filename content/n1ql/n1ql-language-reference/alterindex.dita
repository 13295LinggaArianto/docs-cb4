<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="untitled1">
    <title>ALTER INDEX</title>
    <body>
        <p><i>(Introduced in Couchbase Server 5.1)</i></p>
        <p>Use the <codeph>ALTER INDEX</codeph> statement to change the definition of an existing
            index, or change the placement of an existing index (and replicas) among different GSI
            nodes, or change the replica count of an existing index.</p>
        <p>
            <dl>
                <dlentry>
                    <dt>Prerequisites</dt>
                    <dd>Only users with the suitable roles of <codeph>ALTER INDEX</codeph> are
                        allowed to run this directive.</dd>
                    <dd>This directive is applicable only for Plasma and MOI Indexes; and hence
                        supported only for EE nodes. (Not Applicable for FDB or Views)</dd>
                    <dd>This directive is supported only from 5.0 onwards; if the cluster is in
                        mix-mode, then this directive will not work.</dd>
                    <dd><codeph>ALTER INDEX</codeph> will not work while the cluster is undergoing a
                        Rebalance.</dd>
                    <dd><codeph>BUILD INDEX</codeph> enforces a per-indexer-per-bucket rule by which
                        multiple DDLs cannot be fired for the same bucket from the same node on
                        which a build is already under progress.</dd>
                </dlentry>
            </dl>
        </p>
        <p><b>Syntax</b></p>
        <p>
            <codeblock>ALTER INDEX <varname>named_keyspace_ref</varname>.<varname>index_name</varname>
[ USING GSI | VIEW ]
WITH {"action":"<varname>action_type</varname>", "nodes": [ &lt;"<varname>node_name1</varname>", "<varname>node_name2</varname>", ...> ] }</codeblock>
        </p>
        <p>
            <dl>
                <dlentry>
                    <dt>Arguments</dt>
                    <dd>
                        <dl>
                            <dlentry>
                                <dt>named_keyspace_ref</dt>
                                <dd>String or an expression that results in a string representing
                                    the corresponding bucket name.</dd>
                            </dlentry>
                        </dl>
                    </dd>
                    <dd>
                        <dl>
                            <dlentry>
                                <dt>index_name</dt>
                                <dd>String or an expression that results in a string representing
                                    the corresponding index name.</dd>
                            </dlentry>
                        </dl>
                        <dl>
                            <dlentry>
                                <dt>USING GSI | VIEW</dt>
                                <dd>[Default is "<codeph>USING GSI</codeph>"]</dd>
                                <dd>Currently, <codeph>VIEW</codeph> and FTS indexes are not
                                    supported.</dd>
                            </dlentry>
                        </dl>
                        <dl>
                            <dlentry>
                                <dt>WITH</dt>
                                <dd>Specifies the alter operation that needs to be performed. It is
                                    passed as-is from N1QL to GSI, where it is interpreted.</dd>
                                <dd>
                                    <dl>
                                        <dlentry>
                                            <dt>action_type</dt>
                                            <dd>
                                                <dl>
                                                  <dlentry>
                                                  <dt>move</dt>
                                                  <dd>Moves an index and its replica to different
                                                  nodes.</dd>
                                                  </dlentry>
                                                </dl>
                                            </dd>
                                        </dlentry>
                                    </dl>
                                    <dl>
                                        <dlentry>
                                            <dt>node_name1, node_name2, ... , node_nameX</dt>
                                            <dd>String or an expression that results in a string
                                                representing the node address(es).</dd>
                                        </dlentry>
                                    </dl>
                                </dd>
                            </dlentry>
                        </dl>
                    </dd>
                </dlentry>
            </dl>
            <dl>
                <dlentry>
                    <dt>Output</dt>
                    <dd>If the <codeph>ALTER INDEX</codeph> fails, then:<ul id="ul_vgx_lzq_1cb">
                            <li>The original indexes should continue to service the Query
                                Scans.</li>
                            <li>The UI should reflect the original set of nodes.</li>
                            <li>A log should capture the failure along with the results.</li>
                        </ul></dd>
                </dlentry>
            </dl>
        </p>
        <p/>
        <section id="section_zng_vvk_1cb"><title>Examples</title><p>When using the below examples,
                make sure Couchbase Server 5.1 is already running on the named
                    nodes.</p><p><b>Example 1: Moving an index from one node to
                another.</b></p><p>Create an index on node 1, then move it to node
                2.<codeblock>CREATE INDEX idx_sched1 ON `travel-sample`(attr1) 
WITH {"nodes": ["127.0.0.<b>1</b>:8091"]}

ALTER INDEX `travel-sample`.idx_sched1 
WITH {"action":"move","nodes": ["127.0.0.<b>2</b>:8091"]}</codeblock></p><p><b>Example
                    2: Moving an index replica from one node to another.</b></p><p>Create an index
                on node 24 with a replica on node 25, then move its replica from node 25 to
                26.<codeblock>CREATE INDEX idx_sched2 ON `travel-sample`(attr2) 
WITH {"nodes": ["127.0.0.24:8091", "127.0.0.<b>25</b>:8091"}

ALTER INDEX `travel-sample`.idx_sched2
WITH {"action":"move","nodes": ["127.0.0.24:8091", "127.0.0.<b>26</b>:8091"}</codeblock></p><b>Example
                3: Moving multiple replicas.</b><p>Create an index on node 34 with replicas on nodes 35 and 36, then move the replicas to nodes 37
                and 38.<codeblock>CREATE INDEX idx_sched3 ON `travel-sample`(attr3) 
WITH {"nodes": ["127.0.0.34:8091", "127.0.0.<b>35</b>:8091", "127.0.0.<b>36</b>:8091"}

ALTER INDEX `travel-sample`.idx_sched3
WITH {"action":"move","nodes": ["127.0.0.24:8091", "127.0.0.<b>37</b>:8091", "127.0.0.<b>38</b>:8091"}</codeblock>
                <!--
                ### TBD ###  <b>Example 4: Creating new replicas.</b></p><p>Create an index
                on<codeblock>CREATE INDEX</codeblock></p><p>
                ### TBD ###  <b>Example 5: Deleting replicas.</b></p><p>Create an index on node
                51<codeblock>CREATE INDEX</codeblock></p>
--></p> 
            
                </section>
        <section id="section_v4d_4vj_1cb">
            <title>Related Links</title>
            <p/>
        </section>
    </body>
</topic>
