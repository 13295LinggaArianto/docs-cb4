<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  </head>

<body>
<article class="doc">
<h1>Scaling a CouchbaseCluster</h1>
<div class="paragraph">
<p>Using the Couchbase Operator, you can easily scale clusters and services
up and down. The handling of individual nodes is defined in the servers
section of the <a href="couchbaseClusterConfig.adoc">Couchbase cluster
specification</a>. Here is an example of a definition for a cluster where
all nodes run the data, index, search, and query services.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">servers:
  - size: 3
    name: all_services
    services:
      - data
      - index
      - query
      - search
    dataPath: /opt/couchbase/var/lib/couchbase/data
    indexPath: /opt/couchbase/var/lib/couchbase/data</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration specifies that the cluster should contain 3 nodes
running the data, index, query, and search services and that the data
and index path are each set to /opt/couchbase/var/lib/couchbase/data. To
scale these servers, you only need to change the <code>size</code> parameter and
then push the new configuration into Kubernetes to increase or decrease
the number of nodes in the cluster. To update the configuration in
Kubernetes, run the following command: On Kubernetes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl replace -f &lt;path to config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>On OpenShift:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">    oc replace -f &lt;path to config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can also edit the configuration of a Couchbase cluster
directly by running the command below. On Kubernetes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl edit cbc &lt;name of cluster&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>On OpenShift:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">    oc edit cbc &lt;name of cluster&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command pulls the current configuration for the cluster from
Kubernetes and opens it up in an editor. You can then edit the
configuration, and upon saving and closing the file, the updated
configuration is automatically pushed back into Kubernetes.</p>
</div>
<div class="paragraph">
<p>One thing you will notice when scaling a cluster is that the servers
section takes a list of server configurations. The configuration is
setup this way so that services can be scaled independently. For
example, if your Couchbase cluster contains 3 nodes running the data
service, one node running the query service, and one node running the
index service, then the servers section of your configuration would look
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">servers:
  - size: 3
    name: data_services
    services:
      - data
    dataPath: /opt/couchbase/var/lib/couchbase/data
    indexPath: /opt/couchbase/var/lib/couchbase/data
  - size: 1
    name: index_services
    services:
      - index
    dataPath: /opt/couchbase/var/lib/couchbase/data
    indexPath: /opt/couchbase/var/lib/couchbase/data
  - size: 1
    name: query_services
    services:
      - query
    dataPath: /opt/couchbase/var/lib/couchbase/data
    indexPath: /opt/couchbase/var/lib/couchbase/data</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration creates a 5-nodes cluster with different services
running on each pod. If you see that your queries are taking longer than
usual, you can scale up your query service independent of the other
services by changing the size of the server specification containing the
query service. For example, update the size from 1 to 2 and push the new
configuration into Kubernetes. The Couchbase Operator will automatically
scale up the query service.</p>
</div>
</article>
</body>
</html>
