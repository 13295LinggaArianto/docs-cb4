<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  </head>
 <body>
<article class="doc">
<h1>Accessing the Couchbase CLI</h1>
<div class="paragraph">
<p>The Couchbase command-line tool <code>couchbase-cli</code> can be used to interact
with the cluster for performing one off administration tasks such as
creating RBAC users and initiating cbcollect info tasks. If your
clusters Web Console is exposed, you can use the CLI tool from any
machine that can access the IP address of your Kubernetes cluster.
Alternatively, couchbase-cli can be run as a Kubernetes job within the
Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p><strong>couchbase-cli to Web Console</strong></p>
</div>
<div class="paragraph">
<p>Prerequisites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>See <a href="adminConsoleAccess.adoc">Accessing the Couchbase Web Console</a> for exposing the Web Console.</p>
</li>
<li>
<p>Download the couchbase-cli to your client machine: <a href="https://github.com/couchbase/couchbase-cli" class="bare">https://github.com/couchbase/couchbase-cli</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the <code>describe</code> command to retrieve the Web Console port: On
Kubernetes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl describe cbc cb-example |  grep "Admin Console Port:"
   Admin Console Port:      32486</code></pre>
</div>
</div>
<div class="paragraph">
<p>On OpenShift:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ oc describe cbc cb-example |  grep "Admin Console Port:"
   Admin Console Port:      32486</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now use couchbase-cli to administer the cluster. For example,
adding an RBAC user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ ./couchbase-cli user-manage -c 192.168.99.100:32486 -u Administrator -p password --rbac-username default --rbac-password password --roles admin --auth-domain local --set
SUCCESS: RBAC user set</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the cluster is being managed by the Couchbase Operator.
Therefore, certain administration tasks such as adding or removing nodes
and buckets can be reverted by the Operator.</p>
</div>
<div class="paragraph">
<p><strong>couchbase-cli as Kubernetes Job</strong></p>
</div>
<div class="paragraph">
<p>The most secure way to use the couchbase-cli with your Kubernetes
cluster is to run as batch jobs. This option allows you to hide the user
name and password of your cluster by allowing the use of Secrets. For
example, you can run a collect info job using the same secret provided
in the cluster spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl create -f https://s3.amazonaws.com/packages.couchbase.com/kubernetes/beta/couchbase-cli-collect-logs.yaml
job "collect-info" created

# check status
$ kubectl get job collect-info
NAME           DESIRED   SUCCESSFUL   AGE
collect-info   1         1            10s</code></pre>
</div>
</div>
<div class="paragraph">
<p>On OpenShift, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ oc create -f https://s3.amazonaws.com/packages.couchbase.com/kubernetes/beta/couchbase-cli-collect-logs.yaml</code></pre>
</div>
</div>
</article>
</body>
</html>
