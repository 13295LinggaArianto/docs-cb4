<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
</head>

    <body>
<article class="doc">
<h1>Prerequisites and Setup</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In order to run the Couchbase Operator all you need is a running
Kubernetes or OpenShift cluster. We support the following releases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kubernetes 1.7+</p>
</li>
<li>
<p>OpenShift 3.7+</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you do not have access to a Kubernetes cluster and plan on using the
Couchbase Operator for development, we recommend using either MiniKube
(single-node Kubernetes cluster) or MiniShift (single-node OpenShift
cluster). Both these products are much easier to install and deploy when
compared to setting up and running an actual Kubernetes or OpenShift
cluster. For installation instructions, see
<a href="https://kubernetes.io/docs/tasks/tools/install-minikube/">MiniKube</a> or
<a href="https://docs.openshift.org/latest/minishift/getting-started/installing.html">MiniShift</a>.</p>
</div>
<div class="paragraph">
<p>Preparing the cluster to run the Couchbase Operator may require setting
up proper RBAC settings in your Kubernetes cluster. Before moving
forward, we recommend reading the deployment guides for our various
deployment options.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="rbacKubernetes.adoc">Kubernetes RBAC</a></p>
</li>
<li>
<p><a href="rbacOpenshift.adoc">OpenShift RBAC</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="setting-up-couchbase-operator"><a class="anchor" href="#setting-up-couchbase-operator"></a>Setting up Couchbase Operator</h3>
<div class="paragraph">
<p>Before you can start deploying Couchbase clusters on either Kubernetes
or OpenShift, you must install the Couchbase Operator into your
Kubernetes or OpenShift deployment. To do so, run the following command:
On Kubernetes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl create -f https://s3.amazonaws.com/packages.couchbase.com/kubernetes/beta/operator.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>On OpenShift:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc create -f https://s3.amazonaws.com/packages.couchbase.com/kubernetes/beta/operator.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running this command will download the Couchbase Operator Docker image
and create a deployment which manages a single instance of the Couchbase
Operator. We use a deployment because we want the Couchbase Operator to
be able to restart if the pod it’s running in dies. When the Couchbase
Operator pod is started for the first time, it registers the
CouchbaseCluster Custom Resource Definition(CRD) with Kubernetes and
registers a controller which listens for updates to the CouchbaseCluster
configurations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This command creates the Couchbase Operator in the default
namespace. To deploy the Operator in another namespace, download this
file and modify the metadata.namespace field to reflect the namespace
you want to install the Operator in.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After you run the <code>kubectl create</code> or <code>oc create</code> command, it generally
takes less than 1 minute for Kubernetes to deploy the Operator and for
the Operator to be ready to run. Using one of the following commands,
you can check the status of the Operator and see the status of your
deployment.</p>
</div>
<div class="paragraph">
<p>On Kubernetes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl get deployments</code></pre>
</div>
</div>
<div class="paragraph">
<p>On OpenShift:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get deployments</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run this command immediately after you run the <code>kubectl create</code>
or `oc create`command, the output will look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
couchbase-operator   1         1         1            0           10s</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the deployment is called ``couchbase-operator''. The
DESIRED field in the output shows that this deployment will create 1 pod
running the Couchbase Operator. The CURRENT field shows that 1 Couchbase
Operator pod has been created. However, the AVAILABLE field indicates
that that pod is not ready yet as its value is 0 and not 1. This means
that the Operator is currently ensuring its CRD is registered with
Kubernetes and is establishing a connection to the Kubernetes master to
allow it to get updates on CouchbaseCluster objects. Once the Operator
is finished with these tasks, it will start managing the Couchbase
cluster and the status will be shown as AVAILABLE. You should continue
to poll the status of the Operator until your output looks similar to
the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
couchbase-operator   1         1         1            1           47s</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also verify that the Couchbase Operator has come up successfully
using the following command: On Kubernetes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl get pods</code></pre>
</div>
</div>
<div class="paragraph">
<p>On OpenShift:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the Couchbase Operator is up and running successfully, the command
returns an output where the status is Running and Ready is 1/1, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                                  READY   STATUS   RESTARTS   AGE
couchbase-operator-1917615544-t5mhp   1/1     Running  0          57s</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you examine the logs using the following command, the message: ``CRD
initialized, listening for events… module=controller'' indicates that
the Couchbase Operator is up and running.</p>
</div>
<div class="paragraph">
<p>On Kubernetes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl logs couchbase-operator-1917615544-t5mhp
time="2018-02-03T02:16:24Z" level=info msg="Obtaining resource lock" module=main
time="2018-02-03T02:16:24Z" level=info msg="Starting event recorder" module=main
time="2018-02-03T02:16:24Z" level=info msg="Attempting to be elected the couchbase-operator leader" module=main
time="2018-02-03T02:16:24Z" level=info msg="I'm the leader, attempt to start the operator" module=main
time="2018-02-03T02:16:24Z" level=info msg="Creating the couchbase-operator controller" module=main
time="2018-02-03T02:16:24Z" level=info msg="Event(v1.ObjectReference{Kind:\"Endpoints\", Namespace:\"testproject\", Name:\"couchbase-operator\", UID:\"3b96e3fa-0888-11e8-a682-028b77caec66\", APIVersion:\"v1\", ResourceVersion:\"599428\", FieldPath:\"\"}): type: 'Normal' reason: 'LeaderElection' couchbase-operator-1917615544-pd4q6 became leader" module=event_recorder
time="2018-02-03T02:16:24Z" level=info msg="CRD initialized, listening for events..." module=controller\</code></pre>
</div>
</div>
<div class="paragraph">
<p>On OpenShift:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc logs couchbase-operator-1917615544-t5mhp</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="uninstall"><a class="anchor" href="#uninstall"></a>Uninstall</h3>
<div class="paragraph">
<p>To uninstall the Couchbase Operator, run the following commands: On
Kubernetes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl delete -f https://s3.amazonaws.com/packages.couchbase.com/kubernetes/beta/operator.yaml
$ kubectl delete crd couchbaseclusters.couchbase.database.couchbase.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>On OpenShift:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc delete -f https://s3.amazonaws.com/packages.couchbase.com/kubernetes/beta/operator.yaml
$ oc delete crd couchbaseclusters.couchbase.database.couchbase.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Uninstalling the Couchbase Operator will not remove or affect any
Couchbase pods in your Kubernetes cluster.</p>
</div>
</div>
</article>
</body>
</html>
